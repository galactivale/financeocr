# Development override for docker-compose
# This file is automatically loaded by docker-compose for development

services:
  backend:
    environment:
      NODE_ENV: development
      DATABASE_URL: postgresql://vaultcpa_user:vaultcpa_secure_password_2024@postgres:5432/vaultcpa
      JWT_SECRET: dev_jwt_secret_key_2024
      CORS_ORIGIN: http://localhost:3000,https://financeocr.com,http://financeocr.com
      PORT: 3080
    volumes:
      - ./server:/app
      - /app/node_modules
    command: sh -c "npm ci && PRISMA_ENGINES_MIRROR=https://binaries.prisma.sh npx prisma generate || npx prisma generate --schema=./prisma/schema.prisma && PORT=3080 npm run dev"

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      target: deps
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:3080
      NEXT_PUBLIC_APP_URL: http://localhost:3000
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
    command: sh -c "npm install --legacy-peer-deps && npm run dev"
    user: root
